(()=>{var t={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},d:(e,s)=>{for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["common/app"];t.n(e)().initializers.add("shebaoting/rss",(function(){console.log("[shebaoting/rss] Hello, forum and admin!")}));const s=flarum.core.compat["forum/app"];var o=t.n(s);const n=flarum.core.compat["common/extend"],a=flarum.core.compat["forum/components/IndexPage"];var i=t.n(a);function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,l(t,e)}const u=flarum.core.compat["common/components/Page"];var c=t.n(u);const d=flarum.core.compat["common/helpers/listItems"];var p=t.n(d);const f=flarum.core.compat["common/Component"];var h=t.n(f),g=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var s=e.prototype;return s.oninit=function(e){t.prototype.oninit.call(this,e),this.feeds=[],this.loadFeeds()},s.loadFeeds=function(){var t=this;app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/rss-items"}).then((function(e){t.feeds=e.data,m.redraw()}))},s.view=function(){return m("div",{className:"RssFeedList"},m("div",{className:"DiscussionList"},m("ul",{class:"DiscussionList-discussions"},this.feeds.map((function(t){return m("li",null,m("div",{class:"DiscussionListItem"},m("div",{className:"DiscussionListItem-content Slidable-content read"},m("a",{href:t.attributes.link,target:"_blank",className:"DiscussionListItem-main"},m("h2",{class:"DiscussionListItem-title"},t.attributes.title),m("ul",{class:"DiscussionListItem-info"},m("li",{class:"item-tags"},m("span",{class:"TagsLabel"},m("span",{class:"TagLabel colored text-contrast--light TagLabel--child",style:"--tag-bg: #6b7eb7;"},m("span",{class:"TagLabel-text"},m("i",{class:"TagLabel-icon icon fas iconfont icon-php"}),m("span",{class:"TagLabel-name"},t.attributes.site_name))))),m("li",{class:"item-terminalPost"},m("span",null,"发布于 ",m("time",null,t.attributes.published_at))))))))})))))},e}(h());const b=flarum.core.compat["common/components/Button"];var v=t.n(b);const y=flarum.core.compat["common/components/Modal"];var S=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var s=e.prototype;return s.oninit=function(e){t.prototype.oninit.call(this,e),this.url="",this.siteTitle="",this.feedId=null,this.loading=!0,console.log("[RssSubmitModal] Modal initialized, starting to load existing feed."),this.loadExistingFeed()},s.loadExistingFeed=function(){var t=this;console.log("[RssSubmitModal] Sending request to load current user feed."),o().request({method:"GET",url:o().forum.attribute("apiUrl")+"/user-rss-feeds"}).then((function(e){if(e.data.length>0){var s=e.data[0];t.feedId=s.id,t.url=s.attributes.url,t.siteTitle=s.attributes.title,console.log("[RssSubmitModal] Found user feed:",s)}else console.log("[RssSubmitModal] No existing feed found for the user.");t.loading=!1,m.redraw()})).catch((function(e){console.error("[RssSubmitModal] Error loading existing feed:",e),t.loading=!1,m.redraw()}))},s.className=function(){return"RssSubmitModal Modal--small"},s.title=function(){return"提交 RSS 站点"},s.content=function(){var t=this;return this.loading?(console.log("[RssSubmitModal] Loading feed data, showing loading state."),m("div",{className:"Modal-body"},m("p",null,"加载中..."))):(console.log("[RssSubmitModal] Feed data loaded, rendering form with URL:",this.url,"and siteTitle:",this.siteTitle),m("div",{className:"Modal-body"},m("div",{className:"Form-group"},m("label",null,"站点名称"),m("input",{className:"FormControl",placeholder:"请输入站点名称",value:this.siteTitle,oninput:function(e){t.siteTitle=e.target.value,console.log("[RssSubmitModal] Updated siteTitle:",t.siteTitle)}})),m("div",{className:"Form-group"},m("label",null,"RSS 链接"),m("input",{className:"FormControl",placeholder:"请输入 RSS 链接",value:this.url,oninput:function(e){t.url=e.target.value,console.log("[RssSubmitModal] Updated URL:",t.url)}})),m("div",{className:"Form-group"},m(v(),{className:"Button Button--primary",onclick:this.onsubmit.bind(this),loading:this.loading},"提交"))))},s.onsubmit=function(t){var e=this;t.preventDefault(),this.loading=!0,console.log("[RssSubmitModal] Submitting form with URL:",this.url,"and siteTitle:",this.siteTitle);var s=this.feedId?"PATCH":"POST",n=this.feedId?o().forum.attribute("apiUrl")+"/rss-feeds/"+this.feedId:o().forum.attribute("apiUrl")+"/rss-feeds";console.log("[RssSubmitModal] API method:",s,"API URL:",n),o().request({method:s,url:n,body:{data:{attributes:{url:this.url,title:this.siteTitle}}}}).then((function(){e.loading=!1,console.log("[RssSubmitModal] Form submitted successfully."),o().alerts.show({type:"success"},"RSS 站点已成功提交！"),e.hide(),m.redraw()})).catch((function(t){e.loading=!1,console.error("[RssSubmitModal] Error submitting form:",t),o().alerts.show({type:"error"},"提交失败，请重试。"),m.redraw()}))},e}(t.n(y)()),N=function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e.prototype.view=function(){return m("div",{className:"IndexPage-toolbar rss-subsec"},m("ul",{className:"IndexPage-toolbar-action"},m("li",{className:"item-markAllAsRead"},m(v(),{className:"Button hasIcon",onclick:function(){return o().modal.show(S)}},"提交站点"))))},e}(h()),R=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var s=e.prototype;return s.oninit=function(e){t.prototype.oninit.call(this,e),o().setTitle("RSS Aggregator")},s.view=function(){return m("div",{className:"IndexPage"},i().prototype.hero()," ",m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,p()(i().prototype.sidebarItems().toArray()))," "),m("div",{className:"RssFeedListContent IndexPage-results sideNavOffset"},m(N,null),m(g,null)," "))))},e}(c());o().initializers.add("shebaoting/rss",(function(){(0,n.extend)(i().prototype,"navItems",(function(t){t.add("rss",m("a",{href:o().route("rss.feed"),onclick:function(t){t.preventDefault(),m.route.set(o().route("rss.feed"))},className:"hasIcon"},[m("i",{className:"icon fas fa-rss Button-icon","aria-hidden":"true"}),m("span",{className:"Button-label"},"独立博客")]),-10)})),o().routes["rss.feed"]={path:"/rss",component:R},console.log("[shebaoting/rss] RSS Aggregator link added to the navbar!")}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map